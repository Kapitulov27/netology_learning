# CMD vs ENTRYPOINT: Сравнение и паттерны использования

## Базовые правила

1. **Если не указать CMD или ENTRYPOINT:**
   - Используются значения из базового образа (видно в `docker history`)
   
2. **Ubuntu по умолчанию:**
   ```dockerfile
   ENTRYPOINT ["/bin/sh", "-c"]
   CMD ["bash"]
   ```
   
3. **Можно указать ТОЛЬКО CMD или ТОЛЬКО ENTRYPOINT**
   - Разница только в user experience
   - Можно вообще не использовать CMD/ENTRYPOINT в Dockerfile и определять их при запуске в docker/k8s

---

## Переопределение при запуске

### CMD легко перезаписать:

```bash
docker run --rm test_entry_cmd_2 ping netology.ru
# CMD ["/bin/ping", "ya.ru"] заменяется на "ping netology.ru"
```

### ENTRYPOINT сложнее перезаписать:

```bash
docker run --rm test_entry_cmd_1 netology.ru
# Аргумент ДОБАВЛЯЕТСЯ: /bin/ping ya.ru netology.ru (ошибка!)

docker run --rm --entrypoint "ping" test_entry_cmd_1 netology.ru
# Только с флагом --entrypoint происходит замена
```

---

## Когда что использовать

### CMD:
- ✓ Когда нужна гибкость (легко переопределить)
- ✓ Если контейнер = набор утилит "швейцарский нож" (ansible+terraform+kubectl+yc+ping+curl+telnet+...)

### ENTRYPOINT:
- ✓ Фиксированное приложение
- ✓ Контейнер = конкретный сервис

---

## Идеальная комбинация: ENTRYPOINT + CMD

### Пример 1: Web сервер

```dockerfile
ENTRYPOINT ["gunicorn", "config.wsgi"]
CMD ["-w", "4"]
```

- **По умолчанию:** `gunicorn config.wsgi -w 4`
- **Переопределить:** `docker run app -w 44`

### Пример 2: База данных MySQL

```dockerfile
ENTRYPOINT ["mysqld"]
CMD ["--default-authentication-plugin=caching_sha2_password"]
```

- **По умолчанию:** `mysqld --default-authentication-plugin=caching_sha2_password`
- **Переопределить:** `docker run db --default-authentication-plugin=mysql_native_password`

### Пример 3: Python приложение

```dockerfile
ENTRYPOINT ["python", "app.py"]
CMD ["--env", "development", "--host", "0.0.0.0", "--port", "8000"]
```

- **По умолчанию:** `python app.py --env development --host 0.0.0.0 --port 8000`
- **Переопределить:** `docker run app --port 9000 --env production`

---

## Преимущества паттерна ENTRYPOINT + CMD

- ✓ **ENTRYPOINT фиксирует приложение** → Невозможно случайно запустить что-то другое
- ✓ **CMD задает разумные дефолты** → Работает "из коробки"
- ✓ **Легко переопределить параметры** → Без --entrypoint, просто добавить аргументы
- ✓ **Безопасно для production** → Приложение всегда одно, меняются только параметры

---

## Задача ENTRYPOINT vs CMD

**ENTRYPOINT** отвечает на вопрос:
> "**КАКОЕ** приложение запускать?"

**CMD** отвечает на вопрос:
> "**С КАКИМИ** параметрами его запускать?"

